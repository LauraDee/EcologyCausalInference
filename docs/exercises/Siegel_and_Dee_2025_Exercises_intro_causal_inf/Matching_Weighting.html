<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Katherine Siegel and Laura Dee">
<meta name="dcterms.date" content="2024-06-17">

<title>Tutorial on propensity score matching and inverse probability of treatment weighting – EBIO 5460: Causal Inference in Ecology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-0a72121b9fcec87d83c9cf685d5385ec.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      EBIO 5460: Causal Inference in Ecology
      </li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">EBIO 5460: Causal Inference in Ecology</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/LauraDee/EcologyCausalInference" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../readings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Readings &amp; Additional Materials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../assignments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments &amp; Evaluation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../coding_resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Coding Resources</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../DAGs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DAG resources</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../policies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">University Policies</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#description" id="toc-description" class="nav-link active" data-scroll-target="#description">Description</a></li>
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set up</a></li>
  <li><a href="#the-context" id="toc-the-context" class="nav-link" data-scroll-target="#the-context">The context</a>
  <ul>
  <li><a href="#directed-acyclic-graph" id="toc-directed-acyclic-graph" class="nav-link" data-scroll-target="#directed-acyclic-graph">Directed acyclic graph</a></li>
  </ul></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The data</a>
  <ul>
  <li><a href="#variable-names" id="toc-variable-names" class="nav-link" data-scroll-target="#variable-names">Variable names</a></li>
  </ul></li>
  <li><a href="#data-exploration" id="toc-data-exploration" class="nav-link" data-scroll-target="#data-exploration">Data exploration</a>
  <ul>
  <li><a href="#whats-the-breakdown-of-private-value-0-vs.-federal-value-1-units" id="toc-whats-the-breakdown-of-private-value-0-vs.-federal-value-1-units" class="nav-link" data-scroll-target="#whats-the-breakdown-of-private-value-0-vs.-federal-value-1-units">What’s the breakdown of private (value = 0) vs.&nbsp;federal (value = 1) units?</a></li>
  <li><a href="#whats-the-breakdown-of-units-that-burned-value-1-in-2002-vs.-units-that-did-not-burn-value-0" id="toc-whats-the-breakdown-of-units-that-burned-value-1-in-2002-vs.-units-that-did-not-burn-value-0" class="nav-link" data-scroll-target="#whats-the-breakdown-of-units-that-burned-value-1-in-2002-vs.-units-that-did-not-burn-value-0">What’s the breakdown of units that burned (value = 1) in 2002 vs.&nbsp;units that did not burn (value = 0)?</a></li>
  <li><a href="#how-do-the-private-in-red-vs-federal-in-blue-units-differ-in-terms-of-potential-confounders" id="toc-how-do-the-private-in-red-vs-federal-in-blue-units-differ-in-terms-of-potential-confounders" class="nav-link" data-scroll-target="#how-do-the-private-in-red-vs-federal-in-blue-units-differ-in-terms-of-potential-confounders">How do the private (in red) vs federal (in blue) units differ in terms of potential confounders?</a></li>
  </ul></li>
  <li><a href="#run-naive-regression" id="toc-run-naive-regression" class="nav-link" data-scroll-target="#run-naive-regression">Run naive regression</a></li>
  <li><a href="#use-matching-to-overcome-issues-with-observed-confounding-variables" id="toc-use-matching-to-overcome-issues-with-observed-confounding-variables" class="nav-link" data-scroll-target="#use-matching-to-overcome-issues-with-observed-confounding-variables">Use matching to overcome issues with observed confounding variables</a>
  <ul>
  <li><a href="#match-the-data" id="toc-match-the-data" class="nav-link" data-scroll-target="#match-the-data">Match the data</a>
  <ul class="collapse">
  <li><a href="#assess-match-quality" id="toc-assess-match-quality" class="nav-link" data-scroll-target="#assess-match-quality">Assess match quality</a></li>
  </ul></li>
  <li><a href="#analyze-the-matched-dataset" id="toc-analyze-the-matched-dataset" class="nav-link" data-scroll-target="#analyze-the-matched-dataset">Analyze the matched dataset</a>
  <ul class="collapse">
  <li><a href="#extract-the-matched-data" id="toc-extract-the-matched-data" class="nav-link" data-scroll-target="#extract-the-matched-data">Extract the matched data</a></li>
  <li><a href="#model-the-effect-of-ownershipmanagement-on-wildfire-probability" id="toc-model-the-effect-of-ownershipmanagement-on-wildfire-probability" class="nav-link" data-scroll-target="#model-the-effect-of-ownershipmanagement-on-wildfire-probability">Model the effect of ownership/management on wildfire probability</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#use-weighting-to-overcome-issues-with-observed-confounding-variables" id="toc-use-weighting-to-overcome-issues-with-observed-confounding-variables" class="nav-link" data-scroll-target="#use-weighting-to-overcome-issues-with-observed-confounding-variables">Use weighting to overcome issues with observed confounding variables</a>
  <ul>
  <li><a href="#weight-the-data" id="toc-weight-the-data" class="nav-link" data-scroll-target="#weight-the-data">Weight the data</a>
  <ul class="collapse">
  <li><a href="#whats-the-range-of-weights" id="toc-whats-the-range-of-weights" class="nav-link" data-scroll-target="#whats-the-range-of-weights">What’s the range of weights?</a></li>
  </ul></li>
  <li><a href="#model-the-effect-of-ownership" id="toc-model-the-effect-of-ownership" class="nav-link" data-scroll-target="#model-the-effect-of-ownership">Model the effect of ownership</a></li>
  </ul></li>
  <li><a href="#compare-outputs-from-the-naive-matched-and-weighted-regressions" id="toc-compare-outputs-from-the-naive-matched-and-weighted-regressions" class="nav-link" data-scroll-target="#compare-outputs-from-the-naive-matched-and-weighted-regressions">Compare outputs from the naive, matched, and weighted regressions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Tutorial on propensity score matching and inverse probability of treatment weighting</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Katherine Siegel and Laura Dee </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 17, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="description" class="level2">
<h2 class="anchored" data-anchor-id="description">Description</h2>
<p>This tutorial demonstrates how to use propensity score matching and inverse probability of treatment weighting using a real dataset from <a href="https://doi.org/10.1007/s10113-022-01950-y">Siegel et al.&nbsp;2022</a>. The dataset for the entire western US is very large and unwieldy, so you’ll work with a subset of data for a single year in Colorado.</p>
</section>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set up</h2>
<p>Load the packages used for data manipulation (tidyverse, sf), making a directed acyclic graph (ggdag), matching (MatchIt), weighting (ipw), and regression models (lme4).</p>
</section>
<section id="the-context" class="level2">
<h2 class="anchored" data-anchor-id="the-context">The context</h2>
<p>The Siegel et al.&nbsp;2022 study examines the effect of forest management (through the proxy of land ownership) on annual burn probability in forests of the western US. Specifically, it looks at the effect of federal (treatment) vs.&nbsp;private (control) ownership on wildfire occurrence in sample units.</p>
<section id="directed-acyclic-graph" class="level3">
<h3 class="anchored" data-anchor-id="directed-acyclic-graph">Directed acyclic graph</h3>
<p>Here’s a DAG for the research question:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Matching_Weighting_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The data</h2>
<p>The data are in the file <em>matching_ipw_data.csv.</em></p>
<section id="variable-names" class="level3">
<h3 class="anchored" data-anchor-id="variable-names">Variable names</h3>
<ul>
<li>state: the state the sample unit is from (Colorado)<br>
</li>
<li>UID: a unique identifier for each sample unit<br>
</li>
<li>year: the year that the fire and climate data is from (2002)<br>
</li>
<li>burned: whether or not the unit burned in 2002 (0 = unburned, 1 = burned)<br>
</li>
<li>prot_cat_recl: the ownership class. 0 = private, 1 = federal<br>
</li>
<li>dist_rds_km: distance to the nearest road, in kiometers<br>
</li>
<li>slope: slope, in degrees<br>
</li>
<li>aspect_srai: solar radiation aspect index<br>
</li>
<li>elev_km: elevation, in 1000 m<br>
</li>
<li>lon: longitude<br>
</li>
<li>lat: latitude<br>
</li>
<li>pdsi_avg_season: seasonal average Palmer Drought Severity Index value (fall, spring, summer, winter)<br>
</li>
<li>soil_avg_season: seasonal average soil moisture (fall, spring, summer, winter)<br>
</li>
<li>tmmn_avg_season: seasonal average minimum temperature (fall, spring, summer, winter)</li>
<li>tmmx_avg_season: seasonal average maximum temperature (fall, spring, summer, winter)<br>
</li>
<li>vs_max_season: seasonal average maximum wind speed (fall, spring, summer, winter)<br>
</li>
<li>total_precip_season: total seasonal precipitation (fall, spring, summer, winter)<br>
</li>
<li>prev_yr_precip: total precipitation in the previous year</li>
</ul>
</section>
</section>
<section id="data-exploration" class="level2">
<h2 class="anchored" data-anchor-id="data-exploration">Data exploration</h2>
<section id="whats-the-breakdown-of-private-value-0-vs.-federal-value-1-units" class="level3">
<h3 class="anchored" data-anchor-id="whats-the-breakdown-of-private-value-0-vs.-federal-value-1-units">What’s the breakdown of private (value = 0) vs.&nbsp;federal (value = 1) units?</h3>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Units on federal (=1) and private (=0) land</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Var1</th>
<th style="text-align: right;">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: right;">22877</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">60654</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="whats-the-breakdown-of-units-that-burned-value-1-in-2002-vs.-units-that-did-not-burn-value-0" class="level3">
<h3 class="anchored" data-anchor-id="whats-the-breakdown-of-units-that-burned-value-1-in-2002-vs.-units-that-did-not-burn-value-0">What’s the breakdown of units that burned (value = 1) in 2002 vs.&nbsp;units that did not burn (value = 0)?</h3>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Units that burned (=1) or did not burn (=0) in 2002</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Var1</th>
<th style="text-align: right;">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: right;">82189</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">1342</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="how-do-the-private-in-red-vs-federal-in-blue-units-differ-in-terms-of-potential-confounders" class="level3">
<h3 class="anchored" data-anchor-id="how-do-the-private-in-red-vs-federal-in-blue-units-differ-in-terms-of-potential-confounders">How do the private (in red) vs federal (in blue) units differ in terms of potential confounders?</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Matching_Weighting_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="run-naive-regression" class="level2">
<h2 class="anchored" data-anchor-id="run-naive-regression">Run naive regression</h2>
<p>We could just run a naive regression, ignoring the potential impact of confounders. There are some highly correlated covariates in the model, but let’s ignore them for now. Let’s see what that would yield:</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Coefficient estimates for naive model</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Std. Error</th>
<th style="text-align: right;">p value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-14.088</td>
<td style="text-align: right;">3.606</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">prot_cat_recl1</td>
<td style="text-align: right;">1.229</td>
<td style="text-align: right;">0.095</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dist_rds_km</td>
<td style="text-align: right;">-0.079</td>
<td style="text-align: right;">0.029</td>
<td style="text-align: right;">0.007</td>
</tr>
<tr class="even">
<td style="text-align: left;">slope</td>
<td style="text-align: right;">0.019</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aspect_srai</td>
<td style="text-align: right;">0.149</td>
<td style="text-align: right;">0.084</td>
<td style="text-align: right;">0.077</td>
</tr>
<tr class="even">
<td style="text-align: left;">elev_km</td>
<td style="text-align: right;">1.627</td>
<td style="text-align: right;">0.215</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pdsi_avg_winter</td>
<td style="text-align: right;">-0.014</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">pdsi_avg_spring</td>
<td style="text-align: right;">-0.021</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pdsi_avg_summer</td>
<td style="text-align: right;">0.036</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">pdsi_avg_fall</td>
<td style="text-align: right;">-0.004</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">0.143</td>
</tr>
<tr class="odd">
<td style="text-align: left;">soil_avg_winter</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.597</td>
</tr>
<tr class="even">
<td style="text-align: left;">soil_avg_spring</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">soil_avg_summer</td>
<td style="text-align: right;">-0.002</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.200</td>
</tr>
<tr class="even">
<td style="text-align: left;">soil_avg_fall</td>
<td style="text-align: right;">-0.002</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.003</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmn_avg_winter</td>
<td style="text-align: right;">-0.112</td>
<td style="text-align: right;">0.011</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmn_avg_spring</td>
<td style="text-align: right;">0.054</td>
<td style="text-align: right;">0.026</td>
<td style="text-align: right;">0.035</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmn_avg_summer</td>
<td style="text-align: right;">-0.095</td>
<td style="text-align: right;">0.022</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmn_avg_fall</td>
<td style="text-align: right;">0.131</td>
<td style="text-align: right;">0.026</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmx_avg_winter</td>
<td style="text-align: right;">0.133</td>
<td style="text-align: right;">0.012</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmx_avg_spring</td>
<td style="text-align: right;">-0.017</td>
<td style="text-align: right;">0.021</td>
<td style="text-align: right;">0.431</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmx_avg_summer</td>
<td style="text-align: right;">0.265</td>
<td style="text-align: right;">0.021</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmx_avg_fall</td>
<td style="text-align: right;">-0.395</td>
<td style="text-align: right;">0.029</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vs_max_winter</td>
<td style="text-align: right;">0.044</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">vs_max_spring</td>
<td style="text-align: right;">-0.038</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vs_max_summer</td>
<td style="text-align: right;">-0.007</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">0.157</td>
</tr>
<tr class="even">
<td style="text-align: left;">vs_max_fall</td>
<td style="text-align: right;">-0.045</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total_precip_winter</td>
<td style="text-align: right;">-0.152</td>
<td style="text-align: right;">0.008</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">total_precip_spring</td>
<td style="text-align: right;">-0.034</td>
<td style="text-align: right;">0.007</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total_precip_summer</td>
<td style="text-align: right;">0.130</td>
<td style="text-align: right;">0.007</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">total_precip_fall</td>
<td style="text-align: right;">0.044</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">prev_yr_precip</td>
<td style="text-align: right;">-0.003</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">0.196</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="use-matching-to-overcome-issues-with-observed-confounding-variables" class="level2">
<h2 class="anchored" data-anchor-id="use-matching-to-overcome-issues-with-observed-confounding-variables">Use matching to overcome issues with observed confounding variables</h2>
<section id="match-the-data" class="level3">
<h3 class="anchored" data-anchor-id="match-the-data">Match the data</h3>
<p>Match the data on the observable covariates, using the MatchIt package. You can play around with the settings to see how it affects the matched data you end up with.</p>
<section id="assess-match-quality" class="level4">
<h4 class="anchored" data-anchor-id="assess-match-quality">Assess match quality</h4>
<p>Take a look at the quality of the matches: how many units were matched? Control = private units, Treated = federal units</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Breakdown of matched and unmatched units</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Control</th>
<th style="text-align: right;">Treated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">All (ESS)</td>
<td style="text-align: right;">22877</td>
<td style="text-align: right;">60654</td>
</tr>
<tr class="even">
<td style="text-align: left;">All</td>
<td style="text-align: right;">22877</td>
<td style="text-align: right;">60654</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Matched (ESS)</td>
<td style="text-align: right;">14945</td>
<td style="text-align: right;">14945</td>
</tr>
<tr class="even">
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">14945</td>
<td style="text-align: right;">14945</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unmatched</td>
<td style="text-align: right;">7932</td>
<td style="text-align: right;">45709</td>
</tr>
<tr class="even">
<td style="text-align: left;">Discarded</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>What are the covariate means in the matched dataset for the treated (federal) and control (private) units? What was the covariate balance after matching?</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Covariate balance of matched dataset</caption>
<colgroup>
<col style="width: 24%">
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Means Treated</th>
<th style="text-align: right;">Means Control</th>
<th style="text-align: right;">Standardized Mean Difference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">distance</td>
<td style="text-align: right;">0.6175546</td>
<td style="text-align: right;">0.6158610</td>
<td style="text-align: right;">0.0094201</td>
</tr>
<tr class="even">
<td style="text-align: left;">elev_km</td>
<td style="text-align: right;">2.5041427</td>
<td style="text-align: right;">2.4860995</td>
<td style="text-align: right;">0.0386318</td>
</tr>
<tr class="odd">
<td style="text-align: left;">slope</td>
<td style="text-align: right;">13.3461585</td>
<td style="text-align: right;">13.1416783</td>
<td style="text-align: right;">0.0218229</td>
</tr>
<tr class="even">
<td style="text-align: left;">aspect_srai</td>
<td style="text-align: right;">0.4408603</td>
<td style="text-align: right;">0.4421638</td>
<td style="text-align: right;">-0.0037552</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lon</td>
<td style="text-align: right;">850258.8129272</td>
<td style="text-align: right;">845066.5747204</td>
<td style="text-align: right;">0.0544996</td>
</tr>
<tr class="even">
<td style="text-align: left;">lat</td>
<td style="text-align: right;">4319761.5608274</td>
<td style="text-align: right;">4321966.2446682</td>
<td style="text-align: right;">-0.0183548</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dist_rds_km</td>
<td style="text-align: right;">0.5773463</td>
<td style="text-align: right;">0.5285751</td>
<td style="text-align: right;">0.0359075</td>
</tr>
<tr class="even">
<td style="text-align: left;">prev_yr_precip</td>
<td style="text-align: right;">415.2926731</td>
<td style="text-align: right;">413.7834727</td>
<td style="text-align: right;">0.0100340</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vs_max_fall</td>
<td style="text-align: right;">333.4980930</td>
<td style="text-align: right;">330.1436601</td>
<td style="text-align: right;">0.0480587</td>
</tr>
<tr class="even">
<td style="text-align: left;">vs_max_winter</td>
<td style="text-align: right;">337.5478086</td>
<td style="text-align: right;">332.5623285</td>
<td style="text-align: right;">0.0474268</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vs_max_spring</td>
<td style="text-align: right;">433.4669789</td>
<td style="text-align: right;">430.1073938</td>
<td style="text-align: right;">0.0569886</td>
</tr>
<tr class="even">
<td style="text-align: left;">vs_max_summer</td>
<td style="text-align: right;">370.0096353</td>
<td style="text-align: right;">367.1274005</td>
<td style="text-align: right;">0.0643136</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total_precip_fall</td>
<td style="text-align: right;">135.4748745</td>
<td style="text-align: right;">136.7334225</td>
<td style="text-align: right;">-0.0266053</td>
</tr>
<tr class="even">
<td style="text-align: left;">total_precip_winter</td>
<td style="text-align: right;">49.2408832</td>
<td style="text-align: right;">48.9946470</td>
<td style="text-align: right;">0.0102433</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total_precip_spring</td>
<td style="text-align: right;">43.5216460</td>
<td style="text-align: right;">44.2109067</td>
<td style="text-align: right;">-0.0351669</td>
</tr>
<tr class="even">
<td style="text-align: left;">total_precip_summer</td>
<td style="text-align: right;">74.1271328</td>
<td style="text-align: right;">73.3822014</td>
<td style="text-align: right;">0.0370406</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmx_avg_fall</td>
<td style="text-align: right;">129.5169399</td>
<td style="text-align: right;">130.7038920</td>
<td style="text-align: right;">-0.0368784</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmx_avg_winter</td>
<td style="text-align: right;">30.7551466</td>
<td style="text-align: right;">31.4414408</td>
<td style="text-align: right;">-0.0293219</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmx_avg_spring</td>
<td style="text-align: right;">117.5830043</td>
<td style="text-align: right;">118.7652058</td>
<td style="text-align: right;">-0.0290855</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmx_avg_summer</td>
<td style="text-align: right;">262.3050742</td>
<td style="text-align: right;">263.7936657</td>
<td style="text-align: right;">-0.0361478</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmn_avg_fall</td>
<td style="text-align: right;">-29.5255715</td>
<td style="text-align: right;">-28.6079402</td>
<td style="text-align: right;">-0.0378691</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmn_avg_winter</td>
<td style="text-align: right;">-136.7402699</td>
<td style="text-align: right;">-135.5962752</td>
<td style="text-align: right;">-0.0395408</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmn_avg_spring</td>
<td style="text-align: right;">-56.5992863</td>
<td style="text-align: right;">-55.5367012</td>
<td style="text-align: right;">-0.0311808</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmn_avg_summer</td>
<td style="text-align: right;">64.7037359</td>
<td style="text-align: right;">65.6066020</td>
<td style="text-align: right;">-0.0292879</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pdsi_avg_fall</td>
<td style="text-align: right;">-307.7629977</td>
<td style="text-align: right;">-306.1462250</td>
<td style="text-align: right;">-0.0233885</td>
</tr>
<tr class="even">
<td style="text-align: left;">pdsi_avg_winter</td>
<td style="text-align: right;">-221.2940560</td>
<td style="text-align: right;">-223.2854243</td>
<td style="text-align: right;">0.0277561</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pdsi_avg_spring</td>
<td style="text-align: right;">-351.1321289</td>
<td style="text-align: right;">-352.4421100</td>
<td style="text-align: right;">0.0165642</td>
</tr>
<tr class="even">
<td style="text-align: left;">pdsi_avg_summer</td>
<td style="text-align: right;">-504.4508308</td>
<td style="text-align: right;">-504.6720419</td>
<td style="text-align: right;">0.0030818</td>
</tr>
<tr class="odd">
<td style="text-align: left;">soil_avg_fall</td>
<td style="text-align: right;">123.7579123</td>
<td style="text-align: right;">125.0271440</td>
<td style="text-align: right;">-0.0069754</td>
</tr>
<tr class="even">
<td style="text-align: left;">soil_avg_winter</td>
<td style="text-align: right;">163.2296866</td>
<td style="text-align: right;">165.6294190</td>
<td style="text-align: right;">-0.0225604</td>
</tr>
<tr class="odd">
<td style="text-align: left;">soil_avg_spring</td>
<td style="text-align: right;">210.8781755</td>
<td style="text-align: right;">215.3971451</td>
<td style="text-align: right;">-0.0262021</td>
</tr>
<tr class="even">
<td style="text-align: left;">soil_avg_summer</td>
<td style="text-align: right;">113.1436601</td>
<td style="text-align: right;">114.4098138</td>
<td style="text-align: right;">-0.0126119</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Comparison of standardized mean differences in the covariate values in the full vs.&nbsp;matched dataset</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Matching_Weighting_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="analyze-the-matched-dataset" class="level3">
<h3 class="anchored" data-anchor-id="analyze-the-matched-dataset">Analyze the matched dataset</h3>
<section id="extract-the-matched-data" class="level4">
<h4 class="anchored" data-anchor-id="extract-the-matched-data">Extract the matched data</h4>
<p>First, you’ll need to extract the matched data and use the UIDs from the matched data to subset the full dataset for analysis.</p>
</section>
<section id="model-the-effect-of-ownershipmanagement-on-wildfire-probability" class="level4">
<h4 class="anchored" data-anchor-id="model-the-effect-of-ownershipmanagement-on-wildfire-probability">Model the effect of ownership/management on wildfire probability</h4>
<p>Again, there are correlated covariates, but let’s just ignore them</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Coefficient estimates for model with matching</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Std. Error</th>
<th style="text-align: right;">p value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-41.135</td>
<td style="text-align: right;">7.993</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">prot_cat_recl1</td>
<td style="text-align: right;">0.868</td>
<td style="text-align: right;">0.116</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dist_rds_km</td>
<td style="text-align: right;">-0.057</td>
<td style="text-align: right;">0.103</td>
<td style="text-align: right;">0.578</td>
</tr>
<tr class="even">
<td style="text-align: left;">slope</td>
<td style="text-align: right;">0.021</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aspect_srai</td>
<td style="text-align: right;">0.044</td>
<td style="text-align: right;">0.142</td>
<td style="text-align: right;">0.760</td>
</tr>
<tr class="even">
<td style="text-align: left;">elev_km</td>
<td style="text-align: right;">1.996</td>
<td style="text-align: right;">0.413</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pdsi_avg_winter</td>
<td style="text-align: right;">-0.018</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">pdsi_avg_spring</td>
<td style="text-align: right;">-0.025</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pdsi_avg_summer</td>
<td style="text-align: right;">0.033</td>
<td style="text-align: right;">0.009</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">pdsi_avg_fall</td>
<td style="text-align: right;">-0.003</td>
<td style="text-align: right;">0.007</td>
<td style="text-align: right;">0.629</td>
</tr>
<tr class="odd">
<td style="text-align: left;">soil_avg_winter</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">0.637</td>
</tr>
<tr class="even">
<td style="text-align: left;">soil_avg_spring</td>
<td style="text-align: right;">0.009</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">soil_avg_summer</td>
<td style="text-align: right;">-0.004</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">0.211</td>
</tr>
<tr class="even">
<td style="text-align: left;">soil_avg_fall</td>
<td style="text-align: right;">-0.001</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.622</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmn_avg_winter</td>
<td style="text-align: right;">-0.091</td>
<td style="text-align: right;">0.021</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmn_avg_spring</td>
<td style="text-align: right;">-0.081</td>
<td style="text-align: right;">0.046</td>
<td style="text-align: right;">0.078</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmn_avg_summer</td>
<td style="text-align: right;">-0.185</td>
<td style="text-align: right;">0.044</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmn_avg_fall</td>
<td style="text-align: right;">0.283</td>
<td style="text-align: right;">0.053</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmx_avg_winter</td>
<td style="text-align: right;">0.178</td>
<td style="text-align: right;">0.024</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmx_avg_spring</td>
<td style="text-align: right;">-0.036</td>
<td style="text-align: right;">0.041</td>
<td style="text-align: right;">0.376</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmx_avg_summer</td>
<td style="text-align: right;">0.542</td>
<td style="text-align: right;">0.044</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmx_avg_fall</td>
<td style="text-align: right;">-0.650</td>
<td style="text-align: right;">0.060</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vs_max_winter</td>
<td style="text-align: right;">0.051</td>
<td style="text-align: right;">0.008</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">vs_max_spring</td>
<td style="text-align: right;">-0.083</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vs_max_summer</td>
<td style="text-align: right;">0.011</td>
<td style="text-align: right;">0.010</td>
<td style="text-align: right;">0.278</td>
</tr>
<tr class="even">
<td style="text-align: left;">vs_max_fall</td>
<td style="text-align: right;">-0.044</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total_precip_winter</td>
<td style="text-align: right;">-0.289</td>
<td style="text-align: right;">0.019</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">total_precip_spring</td>
<td style="text-align: right;">-0.136</td>
<td style="text-align: right;">0.015</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total_precip_summer</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">0.399</td>
</tr>
<tr class="even">
<td style="text-align: left;">total_precip_fall</td>
<td style="text-align: right;">-0.003</td>
<td style="text-align: right;">0.010</td>
<td style="text-align: right;">0.730</td>
</tr>
<tr class="odd">
<td style="text-align: left;">prev_yr_precip</td>
<td style="text-align: right;">0.056</td>
<td style="text-align: right;">0.007</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
</section>
<section id="use-weighting-to-overcome-issues-with-observed-confounding-variables" class="level2">
<h2 class="anchored" data-anchor-id="use-weighting-to-overcome-issues-with-observed-confounding-variables">Use weighting to overcome issues with observed confounding variables</h2>
<section id="weight-the-data" class="level3">
<h3 class="anchored" data-anchor-id="weight-the-data">Weight the data</h3>
<p>Use the package ipw</p>
<section id="whats-the-range-of-weights" class="level4">
<h4 class="anchored" data-anchor-id="whats-the-range-of-weights">What’s the range of weights?</h4>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1]    1.00 6069.64</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Matching_Weighting_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-the-effect-of-ownership" class="level3">
<h3 class="anchored" data-anchor-id="model-the-effect-of-ownership">Model the effect of ownership</h3>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Coefficient estimates for model with weighting</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Std. Error</th>
<th style="text-align: right;">p value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-11.151</td>
<td style="text-align: right;">2.821</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">prot_cat_recl1</td>
<td style="text-align: right;">0.921</td>
<td style="text-align: right;">0.054</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dist_rds_km</td>
<td style="text-align: right;">-0.014</td>
<td style="text-align: right;">0.026</td>
<td style="text-align: right;">0.581</td>
</tr>
<tr class="even">
<td style="text-align: left;">slope</td>
<td style="text-align: right;">0.011</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aspect_srai</td>
<td style="text-align: right;">0.077</td>
<td style="text-align: right;">0.066</td>
<td style="text-align: right;">0.245</td>
</tr>
<tr class="even">
<td style="text-align: left;">elev_km</td>
<td style="text-align: right;">1.890</td>
<td style="text-align: right;">0.174</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pdsi_avg_winter</td>
<td style="text-align: right;">-0.018</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">pdsi_avg_spring</td>
<td style="text-align: right;">-0.020</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pdsi_avg_summer</td>
<td style="text-align: right;">0.036</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">pdsi_avg_fall</td>
<td style="text-align: right;">-0.003</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">0.130</td>
</tr>
<tr class="odd">
<td style="text-align: left;">soil_avg_winter</td>
<td style="text-align: right;">-0.001</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.331</td>
</tr>
<tr class="even">
<td style="text-align: left;">soil_avg_spring</td>
<td style="text-align: right;">0.008</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">soil_avg_summer</td>
<td style="text-align: right;">-0.003</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.005</td>
</tr>
<tr class="even">
<td style="text-align: left;">soil_avg_fall</td>
<td style="text-align: right;">-0.002</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmn_avg_winter</td>
<td style="text-align: right;">-0.118</td>
<td style="text-align: right;">0.008</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmn_avg_spring</td>
<td style="text-align: right;">0.059</td>
<td style="text-align: right;">0.019</td>
<td style="text-align: right;">0.002</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmn_avg_summer</td>
<td style="text-align: right;">-0.127</td>
<td style="text-align: right;">0.017</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmn_avg_fall</td>
<td style="text-align: right;">0.158</td>
<td style="text-align: right;">0.021</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmx_avg_winter</td>
<td style="text-align: right;">0.152</td>
<td style="text-align: right;">0.009</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmx_avg_spring</td>
<td style="text-align: right;">-0.026</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">0.108</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmmx_avg_summer</td>
<td style="text-align: right;">0.299</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmmx_avg_fall</td>
<td style="text-align: right;">-0.431</td>
<td style="text-align: right;">0.023</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vs_max_winter</td>
<td style="text-align: right;">0.054</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">vs_max_spring</td>
<td style="text-align: right;">-0.060</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vs_max_summer</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">0.863</td>
</tr>
<tr class="even">
<td style="text-align: left;">vs_max_fall</td>
<td style="text-align: right;">-0.042</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total_precip_winter</td>
<td style="text-align: right;">-0.165</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">total_precip_spring</td>
<td style="text-align: right;">-0.061</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total_precip_summer</td>
<td style="text-align: right;">0.089</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">total_precip_fall</td>
<td style="text-align: right;">0.039</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">prev_yr_precip</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">0.060</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="compare-outputs-from-the-naive-matched-and-weighted-regressions" class="level2">
<h2 class="anchored" data-anchor-id="compare-outputs-from-the-naive-matched-and-weighted-regressions">Compare outputs from the naive, matched, and weighted regressions</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Matching_Weighting_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 136
 $ line                            :List of 6
  ..$ colour       : chr "black"
  ..$ linewidth    : num 0.5
  ..$ linetype     : num 1
  ..$ lineend      : chr "butt"
  ..$ arrow        : logi FALSE
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_line" "element"
 $ rect                            :List of 5
  ..$ fill         : chr "white"
  ..$ colour       : chr "black"
  ..$ linewidth    : num 0.5
  ..$ linetype     : num 1
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_rect" "element"
 $ text                            :List of 11
  ..$ family       : chr ""
  ..$ face         : chr "plain"
  ..$ colour       : chr "black"
  ..$ size         : num 11
  ..$ hjust        : num 0.5
  ..$ vjust        : num 0.5
  ..$ angle        : num 0
  ..$ lineheight   : num 0.9
  ..$ margin       : 'margin' num [1:4] 0points 0points 0points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : logi FALSE
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ title                           : NULL
 $ aspect.ratio                    : NULL
 $ axis.title                      : NULL
 $ axis.title.x                    :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : num 1
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 2.75points 0points 0points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.title.x.top                :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : num 0
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 0points 2.75points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.title.x.bottom             : NULL
 $ axis.title.y                    :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : num 1
  ..$ angle        : num 90
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 2.75points 0points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.title.y.left               : NULL
 $ axis.title.y.right              :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : num 1
  ..$ angle        : num -90
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 0points 0points 2.75points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.text                       :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : chr "grey30"
  ..$ size         : 'rel' num 0.8
  ..$ hjust        : NULL
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : NULL
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.text.x                     :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : num 1
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 2.2points 0points 0points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.text.x.top                 :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : NULL
  ..$ vjust        : num 0
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 0points 2.2points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.text.x.bottom              : NULL
 $ axis.text.y                     :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : num 1
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 2.2points 0points 0points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.text.y.left                : NULL
 $ axis.text.y.right               :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : num 0
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 0points 0points 2.2points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.text.theta                 : NULL
 $ axis.text.r                     :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : num 0.5
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : 'margin' num [1:4] 0points 2.2points 0points 2.2points
  .. ..- attr(*, "unit")= int 8
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ axis.ticks                      :List of 6
  ..$ colour       : chr "grey20"
  ..$ linewidth    : NULL
  ..$ linetype     : NULL
  ..$ lineend      : NULL
  ..$ arrow        : logi FALSE
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_line" "element"
 $ axis.ticks.x                    : NULL
 $ axis.ticks.x.top                : NULL
 $ axis.ticks.x.bottom             : NULL
 $ axis.ticks.y                    : NULL
 $ axis.ticks.y.left               : NULL
 $ axis.ticks.y.right              : NULL
 $ axis.ticks.theta                : NULL
 $ axis.ticks.r                    : NULL
 $ axis.minor.ticks.x.top          : NULL
 $ axis.minor.ticks.x.bottom       : NULL
 $ axis.minor.ticks.y.left         : NULL
 $ axis.minor.ticks.y.right        : NULL
 $ axis.minor.ticks.theta          : NULL
 $ axis.minor.ticks.r              : NULL
 $ axis.ticks.length               : 'simpleUnit' num 2.75points
  ..- attr(*, "unit")= int 8
 $ axis.ticks.length.x             : NULL
 $ axis.ticks.length.x.top         : NULL
 $ axis.ticks.length.x.bottom      : NULL
 $ axis.ticks.length.y             : NULL
 $ axis.ticks.length.y.left        : NULL
 $ axis.ticks.length.y.right       : NULL
 $ axis.ticks.length.theta         : NULL
 $ axis.ticks.length.r             : NULL
 $ axis.minor.ticks.length         : 'rel' num 0.75
 $ axis.minor.ticks.length.x       : NULL
 $ axis.minor.ticks.length.x.top   : NULL
 $ axis.minor.ticks.length.x.bottom: NULL
 $ axis.minor.ticks.length.y       : NULL
 $ axis.minor.ticks.length.y.left  : NULL
 $ axis.minor.ticks.length.y.right : NULL
 $ axis.minor.ticks.length.theta   : NULL
 $ axis.minor.ticks.length.r       : NULL
 $ axis.line                       : list()
  ..- attr(*, "class")= chr [1:2] "element_blank" "element"
 $ axis.line.x                     : NULL
 $ axis.line.x.top                 : NULL
 $ axis.line.x.bottom              : NULL
 $ axis.line.y                     : NULL
 $ axis.line.y.left                : NULL
 $ axis.line.y.right               : NULL
 $ axis.line.theta                 : NULL
 $ axis.line.r                     : NULL
 $ legend.background               :List of 5
  ..$ fill         : NULL
  ..$ colour       : logi NA
  ..$ linewidth    : NULL
  ..$ linetype     : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_rect" "element"
 $ legend.margin                   : 'margin' num [1:4] 5.5points 5.5points 5.5points 5.5points
  ..- attr(*, "unit")= int 8
 $ legend.spacing                  : 'simpleUnit' num 11points
  ..- attr(*, "unit")= int 8
 $ legend.spacing.x                : NULL
 $ legend.spacing.y                : NULL
 $ legend.key                      : NULL
 $ legend.key.size                 : 'simpleUnit' num 1.2lines
  ..- attr(*, "unit")= int 3
 $ legend.key.height               : NULL
 $ legend.key.width                : NULL
 $ legend.key.spacing              : 'simpleUnit' num 5.5points
  ..- attr(*, "unit")= int 8
 $ legend.key.spacing.x            : NULL
 $ legend.key.spacing.y            : NULL
 $ legend.frame                    : NULL
 $ legend.ticks                    : NULL
 $ legend.ticks.length             : 'rel' num 0.2
 $ legend.axis.line                : NULL
 $ legend.text                     :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : 'rel' num 0.8
  ..$ hjust        : NULL
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : NULL
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ legend.text.position            : NULL
 $ legend.title                    :List of 11
  ..$ family       : NULL
  ..$ face         : NULL
  ..$ colour       : NULL
  ..$ size         : NULL
  ..$ hjust        : num 0
  ..$ vjust        : NULL
  ..$ angle        : NULL
  ..$ lineheight   : NULL
  ..$ margin       : NULL
  ..$ debug        : NULL
  ..$ inherit.blank: logi TRUE
  ..- attr(*, "class")= chr [1:2] "element_text" "element"
 $ legend.title.position           : NULL
 $ legend.position                 : chr "right"
 $ legend.position.inside          : NULL
 $ legend.direction                : NULL
 $ legend.byrow                    : NULL
 $ legend.justification            : chr "center"
 $ legend.justification.top        : NULL
 $ legend.justification.bottom     : NULL
 $ legend.justification.left       : NULL
 $ legend.justification.right      : NULL
 $ legend.justification.inside     : NULL
 $ legend.location                 : NULL
 $ legend.box                      : NULL
 $ legend.box.just                 : NULL
 $ legend.box.margin               : 'margin' num [1:4] 0cm 0cm 0cm 0cm
  ..- attr(*, "unit")= int 1
 $ legend.box.background           : list()
  ..- attr(*, "class")= chr [1:2] "element_blank" "element"
 $ legend.box.spacing              : 'simpleUnit' num 11points
  ..- attr(*, "unit")= int 8
  [list output truncated]
 - attr(*, "class")= chr [1:2] "theme" "gg"
 - attr(*, "complete")= logi TRUE
 - attr(*, "validate")= logi TRUE</code></pre>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb3" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Tutorial on propensity score matching and inverse probability of treatment weighting"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Katherine Siegel and Laura Dee"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-06-17"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">## Description</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>This tutorial demonstrates how to use propensity score matching and inverse probability of treatment weighting using a real dataset from <span class="co">[</span><span class="ot">Siegel et al. 2022</span><span class="co">](https://doi.org/10.1007/s10113-022-01950-y)</span>. The dataset for the entire western US is very large and unwieldy, so you'll work with a subset of data for a single year in Colorado. </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">## Set up</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>Load the packages used for data manipulation (tidyverse, sf), making a directed acyclic graph (ggdag), matching (MatchIt), weighting (ipw), and regression models (lme4).</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include = FALSE}</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(echo = TRUE)</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="in">### load libraries</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse) ## for basic coding</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr) ## for rmarkdown</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf) ## for dealing with shapefiles</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggdag) ## for making a directed acyclic graph (DAG)</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="in">library(MatchIt) ## for matching</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="in">library(ipw) ## for weighting</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="in">library(lme4) ## for regression models after matching/weighting</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="in">### get rid of scientific notation</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="in">options(scipen = 999)</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="fu">## The context</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>The Siegel et al. 2022 study examines the effect of forest management (through the proxy of land ownership) on annual burn probability in forests of the western US. Specifically, it looks at the effect of federal (treatment) vs. private (control) ownership on wildfire occurrence in sample units.</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="fu">### Directed acyclic graph</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>Here's a DAG for the research question:  </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 10}</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="in">### make dag</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="in">fire_dag &lt;- dagify(burn_prob ~ land_own + confound_covar,</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="in">                   land_own ~ confound_covar,</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="in">                   </span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="in">                   ### label nodes</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="in">                   labels = c("burn_prob" = "Burn probability",</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="in">                              "land_own" = "Land ownership",</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="in">                              "confound_covar" = "Climate,\n geographic,\n and human\n covariates"),</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="in">                   exposure = "land_own",</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="in">                   outcome = "burn_prob",</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="in">                   </span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="in">                   ### add coordinates</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="in">                   coords = list(x = c(land_own = 1, </span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="in">                                       burn_prob = 3,</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="in">                                       confound_covar = 2),</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="in">                                 y = c(land_own = 1, </span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="in">                                       burn_prob = 1,</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="in">                                       confound_covar = 2)))</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="in">### plot dag</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="in">ggdag_status(fire_dag,</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="in">             use_labels = "label",</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="in">             text = FALSE,</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="in">             label_alpha = 0.5) +</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = FALSE, color = FALSE) +</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_dag()</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="fu">## The data</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>The data are in the file *matching_ipw_data.csv.*</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="fu">### Variable names   </span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>state: the state the sample unit is from (Colorado)  </span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>UID: a unique identifier for each sample unit  </span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>year: the year that the fire and climate data is from (2002)   </span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>burned: whether or not the unit burned in 2002 (0 = unburned, 1 = burned)  </span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>prot_cat_recl: the ownership class. 0 = private, 1 = federal  </span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>dist_rds_km: distance to the nearest road, in kiometers  </span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>slope: slope, in degrees  </span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>aspect_srai: solar radiation aspect index     </span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>elev_km: elevation, in 1000 m  </span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>lon: longitude  </span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>lat: latitude  </span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>pdsi_avg_season: seasonal average Palmer Drought Severity Index value (fall, spring, summer, winter)  </span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>soil_avg_season: seasonal average soil moisture (fall, spring, summer, winter)  </span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>tmmn_avg_season: seasonal average minimum temperature (fall, spring, summer, winter)</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>tmmx_avg_season: seasonal average maximum temperature (fall, spring, summer, winter)  </span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>vs_max_season: seasonal average maximum wind speed (fall, spring, summer, winter)  </span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>total_precip_season: total seasonal precipitation (fall, spring, summer, winter)    </span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>prev_yr_precip: total precipitation in the previous year</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data exploration</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE, fig.height = 12}</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a><span class="in">### open data</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a><span class="in">dat &lt;- read_csv("data/matching_ipw_data.csv")</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="in">### set factor variables</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="in">dat &lt;- dat %&gt;%</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate_at(vars(state,</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a><span class="in">                 UID,</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a><span class="in">                 burned,</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a><span class="in">                 prot_cat_recl),</span></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a><span class="in">            factor)</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a><span class="fu">### What's the breakdown of private (value = 0) vs. federal (value = 1) units? </span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE}</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a><span class="in">### what's the breakdown of private vs. federal sample units? </span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a><span class="in">kable(table(dat$prot_cat_recl),</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Units on federal (=1) and private (=0) land") </span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a><span class="fu">### What's the breakdown of units that burned (value = 1) in 2002 vs. units that did not burn (value = 0)?</span></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE}</span></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a><span class="in">kable(table(dat$burned),</span></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Units that burned (=1) or did not burn (=0) in 2002") ## 82190 did not burn, while 1342 burned</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a><span class="fu">### How do the private (in red) vs federal (in blue) units differ in terms of potential confounders?</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE, fig.height = 12, fig.width = 10}</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a><span class="in">dat %&gt;%</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(!state:prot_cat_recl,</span></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a><span class="in">               names_to = "covars",</span></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a><span class="in">               values_to = "value") %&gt;%</span></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(covars %in% c("elev_km", "prev_yr_precip")) %&gt;%</span></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = value, </span></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a><span class="in">             color = prot_cat_recl,</span></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = prot_cat_recl,</span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = 0.3)) +</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density() +</span></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ covars,</span></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a><span class="in">             scales = "free",</span></span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a><span class="in">             nrow = 8) + </span></span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none") +</span></span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Value") +</span></span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Density")</span></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a><span class="fu">## Run naive regression</span></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>We could just run a naive regression, ignoring the potential impact of confounders. There are some highly correlated covariates in the model, but let's ignore them for now. Let's see what that would yield:</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE, fig.height = 12}</span></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a><span class="in">### fit model</span></span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a><span class="in">fit_naive &lt;- glm(burned ~ prot_cat_recl +</span></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a><span class="in">                     dist_rds_km +</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a><span class="in">                   slope +</span></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a><span class="in">                   aspect_srai +</span></span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a><span class="in">                   elev_km +</span></span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a><span class="in">                   pdsi_avg_winter + pdsi_avg_spring +</span></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a><span class="in">                   pdsi_avg_summer + pdsi_avg_fall +</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a><span class="in">                   soil_avg_winter + soil_avg_spring +</span></span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a><span class="in">                   soil_avg_summer + soil_avg_fall +</span></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a><span class="in">                   tmmn_avg_winter + tmmn_avg_spring +</span></span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a><span class="in">                   tmmn_avg_summer + tmmn_avg_fall +</span></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a><span class="in">                   tmmx_avg_winter + tmmx_avg_spring +</span></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a><span class="in">                   tmmx_avg_summer + tmmx_avg_fall +</span></span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a><span class="in">                   vs_max_winter + vs_max_spring +</span></span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a><span class="in">                   vs_max_summer + vs_max_fall +</span></span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a><span class="in">                   total_precip_winter + total_precip_spring +</span></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a><span class="in">                   total_precip_summer + total_precip_fall +</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a><span class="in">                   prev_yr_precip,</span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a><span class="in">                     data = dat,</span></span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a><span class="in">                   family = binomial(link = "logit"))</span></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a><span class="in">### extract coefficients</span></span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a><span class="in">naive_summary &lt;- summary(fit_naive)</span></span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a><span class="in">naive_coeff &lt;- as.data.frame(naive_summary$coefficients)</span></span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a><span class="in">naive_coeff &lt;- naive_coeff %&gt;% rownames_to_column()</span></span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a><span class="in">### round for ease of presentation</span></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a><span class="in">naive_coeff_round &lt;- naive_coeff %&gt;%</span></span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::select(Variable = rowname, </span></span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a><span class="in">                Estimate,</span></span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a><span class="in">                `Std. Error`,</span></span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a><span class="in">                `p value` = `Pr(&gt;|z|)`) %&gt;%</span></span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Estimate = round(Estimate, 3),</span></span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a><span class="in">         `Std. Error` = round(`Std. Error`, 3),</span></span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a><span class="in">         `p value` = round(`p value`, 3))</span></span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a><span class="in">kable(naive_coeff_round,</span></span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Coefficient estimates for naive model")</span></span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a><span class="fu">## Use matching to overcome issues with observed confounding variables</span></span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a><span class="fu">### Match the data  </span></span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>Match the data on the observable covariates, using the MatchIt package. You can play around with the settings to see how it affects the matched data you end up with. </span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE}</span></span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a><span class="in">### Match the data </span></span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a><span class="in">matched_dat &lt;- matchit(prot_cat_recl ~ elev_km + </span></span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a><span class="in">                         slope + aspect_srai +</span></span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a><span class="in">                         lon + lat +</span></span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a><span class="in">                         dist_rds_km + prev_yr_precip +</span></span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a><span class="in">                         vs_max_fall + vs_max_winter +</span></span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a><span class="in">                         vs_max_spring + vs_max_summer +</span></span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a><span class="in">                         total_precip_fall + </span></span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a><span class="in">                         total_precip_winter +</span></span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a><span class="in">                         total_precip_spring + </span></span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a><span class="in">                         total_precip_summer +</span></span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a><span class="in">                         tmmx_avg_fall + tmmx_avg_winter +</span></span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a><span class="in">                         tmmx_avg_spring + tmmx_avg_summer +</span></span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a><span class="in">                         tmmn_avg_fall + tmmn_avg_winter +</span></span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a><span class="in">                         tmmn_avg_spring + tmmn_avg_summer +</span></span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a><span class="in">                         pdsi_avg_fall + pdsi_avg_winter +</span></span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a><span class="in">                         pdsi_avg_spring + pdsi_avg_summer +</span></span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a><span class="in">                         soil_avg_fall + soil_avg_winter + </span></span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a><span class="in">                         soil_avg_spring + soil_avg_summer,</span></span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a><span class="in">                       method = "nearest", </span></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a><span class="in">                       data = dat, </span></span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a><span class="in">                       distance = "probit",</span></span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a><span class="in">                       caliper = 0.10,  </span></span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a><span class="in">                       m.order = "random")</span></span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a><span class="in">### summarize</span></span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a><span class="in">match_qual &lt;- summary(matched_dat, standardize = TRUE)</span></span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Assess match quality</span></span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>Take a look at the quality of the matches: how many units were matched? Control = private units, Treated = federal units</span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE, fig.height = 8}</span></span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a><span class="in">kable(match_qual$nn,</span></span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Breakdown of matched and unmatched units")</span></span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>What are the covariate means in the matched dataset for the treated (federal) and control (private) units? What was the covariate balance after matching? </span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE, fig.height = 8}</span></span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a><span class="in">### look at the standardized mean differences </span></span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a><span class="in">match_summary &lt;- as.data.frame(match_qual$sum.matched)</span></span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a><span class="in">kable(match_summary %&gt;%</span></span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a><span class="in">        dplyr::select(`Means Treated`,</span></span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a><span class="in">                      `Means Control`,</span></span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a><span class="in">                      `Standardized Mean Difference` = `Std. Mean Diff.`),</span></span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Covariate balance of matched dataset")</span></span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a><span class="in"># range(match_summary$`Std. Mean Diff.`)</span></span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>Comparison of standardized mean differences in the covariate values in the full vs. matched dataset</span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE, fig.height = 8}</span></span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a><span class="in">### plot</span></span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a><span class="in">plot(match_qual)</span></span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a><span class="in">### Some easy visualizations through MatchiIt</span></span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(match, interactive = FALSE)</span></span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(match, type = "jitter", interactive = FALSE)</span></span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analyze the matched dataset</span></span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Extract the matched data</span></span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>First, you'll need to extract the matched data and use the UIDs from the matched data to subset the full dataset for analysis. </span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE}</span></span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a><span class="in">### Extract the matches from the MatchIt object</span></span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a><span class="in">matched_units &lt;- match.data(matched_dat)</span></span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a><span class="in">### Filter full_data to just include the UIDs of the matched subset of the data</span></span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a><span class="in">dat_matched &lt;- dat %&gt;%</span></span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(UID %in% matched_units$UID)</span></span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Model the effect of ownership/management on wildfire probability</span></span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a>Again, there are correlated covariates, but let's just ignore them</span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE}</span></span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a><span class="in">### fit model</span></span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a><span class="in">fit_matched &lt;- glm(burned ~ prot_cat_recl +</span></span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a><span class="in">                     dist_rds_km +</span></span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a><span class="in">                     slope +</span></span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a><span class="in">                     aspect_srai +</span></span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a><span class="in">                     elev_km +</span></span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a><span class="in">                     pdsi_avg_winter + pdsi_avg_spring +</span></span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a><span class="in">                     pdsi_avg_summer + pdsi_avg_fall +</span></span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a><span class="in">                     soil_avg_winter + soil_avg_spring +</span></span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a><span class="in">                     soil_avg_summer + soil_avg_fall +</span></span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a><span class="in">                     tmmn_avg_winter + tmmn_avg_spring +</span></span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a><span class="in">                     tmmn_avg_summer + tmmn_avg_fall +</span></span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a><span class="in">                     tmmx_avg_winter + tmmx_avg_spring +</span></span>
<span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a><span class="in">                     tmmx_avg_summer + tmmx_avg_fall +</span></span>
<span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a><span class="in">                     vs_max_winter + vs_max_spring +</span></span>
<span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a><span class="in">                     vs_max_summer + vs_max_fall +</span></span>
<span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a><span class="in">                     total_precip_winter + total_precip_spring +</span></span>
<span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a><span class="in">                     total_precip_summer + total_precip_fall +</span></span>
<span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a><span class="in">                     prev_yr_precip,</span></span>
<span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a><span class="in">                   data = dat_matched,</span></span>
<span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a><span class="in">                   family = binomial(link = "logit"))</span></span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a><span class="in">### extract coefficients</span></span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a><span class="in">matched_summary &lt;- summary(fit_matched)</span></span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a><span class="in">matched_coeff &lt;- as.data.frame(matched_summary$coefficients)</span></span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a><span class="in">matched_coeff &lt;- matched_coeff %&gt;% rownames_to_column()</span></span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a><span class="in">### round for ease of presentation</span></span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a><span class="in">matched_coeff_round &lt;- matched_coeff %&gt;%</span></span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::select(Variable = rowname, </span></span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a><span class="in">                Estimate,</span></span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a><span class="in">                `Std. Error`,</span></span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a><span class="in">                `p value` = `Pr(&gt;|z|)`) %&gt;%</span></span>
<span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Estimate = round(Estimate, 3),</span></span>
<span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a><span class="in">         `Std. Error` = round(`Std. Error`, 3),</span></span>
<span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a><span class="in">         `p value` = round(`p value`, 3))</span></span>
<span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a><span class="in">kable(matched_coeff_round,</span></span>
<span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Coefficient estimates for model with matching")</span></span>
<span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a><span class="fu">## Use weighting to overcome issues with observed confounding variables</span></span>
<span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a><span class="fu">### Weight the data </span></span>
<span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a>Use the package ipw</span>
<span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE}</span></span>
<span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a><span class="in">### for the ipw package, the exposure needs to be numeric, not a factor</span></span>
<span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a><span class="in">dat_weight &lt;- dat %&gt;%</span></span>
<span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(prot_cat_recl = as.numeric(prot_cat_recl) - 1)</span></span>
<span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a><span class="in">### convert to dataframe</span></span>
<span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a><span class="in">dat_weight &lt;- dat_weight %&gt;%</span></span>
<span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a><span class="in">  as.data.frame()</span></span>
<span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a><span class="in">### Generate weights</span></span>
<span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a><span class="in">weights_ipwpoint &lt;- ipwpoint(exposure = prot_cat_recl,</span></span>
<span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a><span class="in">                             family = "binomial",  </span></span>
<span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a><span class="in">                             link = "logit",</span></span>
<span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a><span class="in">                             denominator = ~ elev_km + </span></span>
<span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a><span class="in">                               slope + aspect_srai +</span></span>
<span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a><span class="in">                               lon + lat +</span></span>
<span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a><span class="in">                               dist_rds_km + prev_yr_precip +</span></span>
<span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a><span class="in">                               vs_max_fall + vs_max_winter +</span></span>
<span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a><span class="in">                               vs_max_spring + vs_max_summer +</span></span>
<span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a><span class="in">                               total_precip_fall + </span></span>
<span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a><span class="in">                               total_precip_winter +</span></span>
<span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a><span class="in">                               total_precip_spring + </span></span>
<span id="cb3-326"><a href="#cb3-326" aria-hidden="true" tabindex="-1"></a><span class="in">                               total_precip_summer +</span></span>
<span id="cb3-327"><a href="#cb3-327" aria-hidden="true" tabindex="-1"></a><span class="in">                               tmmx_avg_fall + tmmx_avg_winter +</span></span>
<span id="cb3-328"><a href="#cb3-328" aria-hidden="true" tabindex="-1"></a><span class="in">                               tmmx_avg_spring + tmmx_avg_summer +</span></span>
<span id="cb3-329"><a href="#cb3-329" aria-hidden="true" tabindex="-1"></a><span class="in">                               tmmn_avg_fall + tmmn_avg_winter +</span></span>
<span id="cb3-330"><a href="#cb3-330" aria-hidden="true" tabindex="-1"></a><span class="in">                               tmmn_avg_spring + tmmn_avg_summer +</span></span>
<span id="cb3-331"><a href="#cb3-331" aria-hidden="true" tabindex="-1"></a><span class="in">                               pdsi_avg_fall + pdsi_avg_winter +</span></span>
<span id="cb3-332"><a href="#cb3-332" aria-hidden="true" tabindex="-1"></a><span class="in">                               pdsi_avg_spring + pdsi_avg_summer +</span></span>
<span id="cb3-333"><a href="#cb3-333" aria-hidden="true" tabindex="-1"></a><span class="in">                               soil_avg_fall + soil_avg_winter + </span></span>
<span id="cb3-334"><a href="#cb3-334" aria-hidden="true" tabindex="-1"></a><span class="in">                               soil_avg_spring + soil_avg_summer,</span></span>
<span id="cb3-335"><a href="#cb3-335" aria-hidden="true" tabindex="-1"></a><span class="in">                             data = dat_weight)</span></span>
<span id="cb3-336"><a href="#cb3-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-337"><a href="#cb3-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-338"><a href="#cb3-338" aria-hidden="true" tabindex="-1"></a><span class="fu">#### What's the range of weights?</span></span>
<span id="cb3-339"><a href="#cb3-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE}</span></span>
<span id="cb3-340"><a href="#cb3-340" aria-hidden="true" tabindex="-1"></a><span class="in">### add weights to dataset</span></span>
<span id="cb3-341"><a href="#cb3-341" aria-hidden="true" tabindex="-1"></a><span class="in">data_ipw &lt;- dat %&gt;%</span></span>
<span id="cb3-342"><a href="#cb3-342" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(ipw = weights_ipwpoint$ipw.weights)</span></span>
<span id="cb3-343"><a href="#cb3-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-344"><a href="#cb3-344" aria-hidden="true" tabindex="-1"></a><span class="in">### print weights</span></span>
<span id="cb3-345"><a href="#cb3-345" aria-hidden="true" tabindex="-1"></a><span class="in">range(data_ipw$ipw)</span></span>
<span id="cb3-346"><a href="#cb3-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a><span class="in">### plot</span></span>
<span id="cb3-348"><a href="#cb3-348" aria-hidden="true" tabindex="-1"></a><span class="in">ipwplot(data_ipw$ipw, </span></span>
<span id="cb3-349"><a href="#cb3-349" aria-hidden="true" tabindex="-1"></a><span class="in">        logscale = TRUE,</span></span>
<span id="cb3-350"><a href="#cb3-350" aria-hidden="true" tabindex="-1"></a><span class="in">        xlab = "Weight (log scale)",</span></span>
<span id="cb3-351"><a href="#cb3-351" aria-hidden="true" tabindex="-1"></a><span class="in">        ylab = "Density",</span></span>
<span id="cb3-352"><a href="#cb3-352" aria-hidden="true" tabindex="-1"></a><span class="in">        main = "", </span></span>
<span id="cb3-353"><a href="#cb3-353" aria-hidden="true" tabindex="-1"></a><span class="in">        ref = FALSE)</span></span>
<span id="cb3-354"><a href="#cb3-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model the effect of ownership</span></span>
<span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE}</span></span>
<span id="cb3-358"><a href="#cb3-358" aria-hidden="true" tabindex="-1"></a><span class="in">### estimate average treatment effect</span></span>
<span id="cb3-359"><a href="#cb3-359" aria-hidden="true" tabindex="-1"></a><span class="in">model_ipw &lt;- glm(burned ~ prot_cat_recl +</span></span>
<span id="cb3-360"><a href="#cb3-360" aria-hidden="true" tabindex="-1"></a><span class="in">                   dist_rds_km +</span></span>
<span id="cb3-361"><a href="#cb3-361" aria-hidden="true" tabindex="-1"></a><span class="in">                   slope +</span></span>
<span id="cb3-362"><a href="#cb3-362" aria-hidden="true" tabindex="-1"></a><span class="in">                   aspect_srai +</span></span>
<span id="cb3-363"><a href="#cb3-363" aria-hidden="true" tabindex="-1"></a><span class="in">                   elev_km +</span></span>
<span id="cb3-364"><a href="#cb3-364" aria-hidden="true" tabindex="-1"></a><span class="in">                   pdsi_avg_winter + pdsi_avg_spring +</span></span>
<span id="cb3-365"><a href="#cb3-365" aria-hidden="true" tabindex="-1"></a><span class="in">                   pdsi_avg_summer + pdsi_avg_fall +</span></span>
<span id="cb3-366"><a href="#cb3-366" aria-hidden="true" tabindex="-1"></a><span class="in">                   soil_avg_winter + soil_avg_spring +</span></span>
<span id="cb3-367"><a href="#cb3-367" aria-hidden="true" tabindex="-1"></a><span class="in">                   soil_avg_summer + soil_avg_fall +</span></span>
<span id="cb3-368"><a href="#cb3-368" aria-hidden="true" tabindex="-1"></a><span class="in">                   tmmn_avg_winter + tmmn_avg_spring +</span></span>
<span id="cb3-369"><a href="#cb3-369" aria-hidden="true" tabindex="-1"></a><span class="in">                   tmmn_avg_summer + tmmn_avg_fall +</span></span>
<span id="cb3-370"><a href="#cb3-370" aria-hidden="true" tabindex="-1"></a><span class="in">                   tmmx_avg_winter + tmmx_avg_spring +</span></span>
<span id="cb3-371"><a href="#cb3-371" aria-hidden="true" tabindex="-1"></a><span class="in">                   tmmx_avg_summer + tmmx_avg_fall +</span></span>
<span id="cb3-372"><a href="#cb3-372" aria-hidden="true" tabindex="-1"></a><span class="in">                   vs_max_winter + vs_max_spring +</span></span>
<span id="cb3-373"><a href="#cb3-373" aria-hidden="true" tabindex="-1"></a><span class="in">                   vs_max_summer + vs_max_fall +</span></span>
<span id="cb3-374"><a href="#cb3-374" aria-hidden="true" tabindex="-1"></a><span class="in">                   total_precip_winter + total_precip_spring +</span></span>
<span id="cb3-375"><a href="#cb3-375" aria-hidden="true" tabindex="-1"></a><span class="in">                   total_precip_summer + total_precip_fall +</span></span>
<span id="cb3-376"><a href="#cb3-376" aria-hidden="true" tabindex="-1"></a><span class="in">                   prev_yr_precip,</span></span>
<span id="cb3-377"><a href="#cb3-377" aria-hidden="true" tabindex="-1"></a><span class="in">                 data = data_ipw,</span></span>
<span id="cb3-378"><a href="#cb3-378" aria-hidden="true" tabindex="-1"></a><span class="in">                 weights = ipw,</span></span>
<span id="cb3-379"><a href="#cb3-379" aria-hidden="true" tabindex="-1"></a><span class="in">                 family = binomial(link = "logit"))</span></span>
<span id="cb3-380"><a href="#cb3-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-381"><a href="#cb3-381" aria-hidden="true" tabindex="-1"></a><span class="in">### extract coefficients</span></span>
<span id="cb3-382"><a href="#cb3-382" aria-hidden="true" tabindex="-1"></a><span class="in">weighted_summary &lt;- summary(model_ipw)</span></span>
<span id="cb3-383"><a href="#cb3-383" aria-hidden="true" tabindex="-1"></a><span class="in">weighted_coeff &lt;- as.data.frame(weighted_summary$coefficients)</span></span>
<span id="cb3-384"><a href="#cb3-384" aria-hidden="true" tabindex="-1"></a><span class="in">weighted_coeff &lt;- weighted_coeff %&gt;% rownames_to_column()</span></span>
<span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a><span class="in">### round for ease of presentation</span></span>
<span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a><span class="in">weighted_coeff_round &lt;- weighted_coeff %&gt;%</span></span>
<span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::select(Variable = rowname, </span></span>
<span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a><span class="in">                Estimate,</span></span>
<span id="cb3-390"><a href="#cb3-390" aria-hidden="true" tabindex="-1"></a><span class="in">                `Std. Error`,</span></span>
<span id="cb3-391"><a href="#cb3-391" aria-hidden="true" tabindex="-1"></a><span class="in">                `p value` = `Pr(&gt;|z|)`) %&gt;%</span></span>
<span id="cb3-392"><a href="#cb3-392" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Estimate = round(Estimate, 3),</span></span>
<span id="cb3-393"><a href="#cb3-393" aria-hidden="true" tabindex="-1"></a><span class="in">         `Std. Error` = round(`Std. Error`, 3),</span></span>
<span id="cb3-394"><a href="#cb3-394" aria-hidden="true" tabindex="-1"></a><span class="in">         `p value` = round(`p value`, 3))</span></span>
<span id="cb3-395"><a href="#cb3-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-396"><a href="#cb3-396" aria-hidden="true" tabindex="-1"></a><span class="in">kable(weighted_coeff_round,</span></span>
<span id="cb3-397"><a href="#cb3-397" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Coefficient estimates for model with weighting")</span></span>
<span id="cb3-398"><a href="#cb3-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-399"><a href="#cb3-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-400"><a href="#cb3-400" aria-hidden="true" tabindex="-1"></a><span class="fu">## Compare outputs from the naive, matched, and weighted regressions</span></span>
<span id="cb3-401"><a href="#cb3-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE}</span></span>
<span id="cb3-402"><a href="#cb3-402" aria-hidden="true" tabindex="-1"></a><span class="in">### add identifying column for coefficient tables</span></span>
<span id="cb3-403"><a href="#cb3-403" aria-hidden="true" tabindex="-1"></a><span class="in">naive_coeff &lt;- naive_coeff %&gt;%</span></span>
<span id="cb3-404"><a href="#cb3-404" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(model = "Naive")</span></span>
<span id="cb3-405"><a href="#cb3-405" aria-hidden="true" tabindex="-1"></a><span class="in">matched_coeff &lt;- matched_coeff %&gt;%</span></span>
<span id="cb3-406"><a href="#cb3-406" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(model = "Matched")</span></span>
<span id="cb3-407"><a href="#cb3-407" aria-hidden="true" tabindex="-1"></a><span class="in">weighted_coeff &lt;- weighted_coeff %&gt;%</span></span>
<span id="cb3-408"><a href="#cb3-408" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(model = "Weighted")</span></span>
<span id="cb3-409"><a href="#cb3-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-410"><a href="#cb3-410" aria-hidden="true" tabindex="-1"></a><span class="in">### combine </span></span>
<span id="cb3-411"><a href="#cb3-411" aria-hidden="true" tabindex="-1"></a><span class="in">all_coeff &lt;- rbind(naive_coeff,</span></span>
<span id="cb3-412"><a href="#cb3-412" aria-hidden="true" tabindex="-1"></a><span class="in">                   matched_coeff,</span></span>
<span id="cb3-413"><a href="#cb3-413" aria-hidden="true" tabindex="-1"></a><span class="in">                   weighted_coeff)</span></span>
<span id="cb3-414"><a href="#cb3-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-415"><a href="#cb3-415" aria-hidden="true" tabindex="-1"></a><span class="in">### fix column names</span></span>
<span id="cb3-416"><a href="#cb3-416" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(all_coeff) &lt;- c("variable",</span></span>
<span id="cb3-417"><a href="#cb3-417" aria-hidden="true" tabindex="-1"></a><span class="in">                         "estimate",</span></span>
<span id="cb3-418"><a href="#cb3-418" aria-hidden="true" tabindex="-1"></a><span class="in">                         "std_error",</span></span>
<span id="cb3-419"><a href="#cb3-419" aria-hidden="true" tabindex="-1"></a><span class="in">                         "z_value",</span></span>
<span id="cb3-420"><a href="#cb3-420" aria-hidden="true" tabindex="-1"></a><span class="in">                         "p_value",</span></span>
<span id="cb3-421"><a href="#cb3-421" aria-hidden="true" tabindex="-1"></a><span class="in">                         "model")</span></span>
<span id="cb3-422"><a href="#cb3-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-423"><a href="#cb3-423" aria-hidden="true" tabindex="-1"></a><span class="in">### plot</span></span>
<span id="cb3-424"><a href="#cb3-424" aria-hidden="true" tabindex="-1"></a><span class="in">all_coeff %&gt;%</span></span>
<span id="cb3-425"><a href="#cb3-425" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(variable == "prot_cat_recl1") %&gt;%</span></span>
<span id="cb3-426"><a href="#cb3-426" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() +</span></span>
<span id="cb3-427"><a href="#cb3-427" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(aes(x = model,</span></span>
<span id="cb3-428"><a href="#cb3-428" aria-hidden="true" tabindex="-1"></a><span class="in">             y = estimate)) +</span></span>
<span id="cb3-429"><a href="#cb3-429" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_errorbar(aes(ymin = estimate - std_error, </span></span>
<span id="cb3-430"><a href="#cb3-430" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymax = estimate + std_error,</span></span>
<span id="cb3-431"><a href="#cb3-431" aria-hidden="true" tabindex="-1"></a><span class="in">                    x = model),</span></span>
<span id="cb3-432"><a href="#cb3-432" aria-hidden="true" tabindex="-1"></a><span class="in">                width = .1) +</span></span>
<span id="cb3-433"><a href="#cb3-433" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_discrete(limits = c('Naive', 'Matched', </span></span>
<span id="cb3-434"><a href="#cb3-434" aria-hidden="true" tabindex="-1"></a><span class="in">                     'Weighted')) +</span></span>
<span id="cb3-435"><a href="#cb3-435" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Model") +</span></span>
<span id="cb3-436"><a href="#cb3-436" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Estimated treatment effect")</span></span>
<span id="cb3-437"><a href="#cb3-437" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw()</span></span>
<span id="cb3-438"><a href="#cb3-438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>